<!-- Template for PROJECT REPORT of CapstoneDesign 2025-2H, initially written by khyoo -->
<!-- 본 파일은 2025년도 컴공 졸업프로젝트의 <1차보고서> 작성을 위한 기본 양식입니다. -->
<!-- 아래에 "*"..."*" 표시는 italic체로 출력하기 위해서 사용한 것입니다. -->
<!-- "내용"에 해당하는 부분을 지우고, 여러분 과제의 내용을 작성해 주세요. -->

# Team-Info
| (1) 과제명 | *홀로 K-pop 안무를 배우는 사용자를 대상으로 Mediapipe 동작 인식과 SAM2 안무 시각화, 3D 기술을 활용한 어려움 해결 및 지속적인 동기부여 제공 서비스*
|:---  |---  |
| (2) 팀 번호 / 팀 이름 | 39-캡짱 |
| (3) 팀 구성원 | - 김유민 (2171007): 리더, *SAM2와 OpenCV를 활용한 안무 실루엣 마스킹 및 컨투어 추출. Spring Boot 기반 백엔드 REST API 설계 및 구현. MySQL을 활용한 데이터베이스 설계 및 관리. AWS 기반 서버 운영 및 배포.* <br><br> - 남궁도윤 (2276098): 팀원, *Mediapipe와 OpenCV를 활용한 안무 동작 분석 및 평가/피드백 시스템 개발 및 검증. MySQL 기반 데이터베이스 모델링 및 구조 설계/유지보수. Spring Boot 백엔드 개발 및 REST API 설계/구현.* <br><br> - 정소희 (2276282) : 팀원, *Unity를 이용한 아바타 기능 구현. Android Studio를 이용한 UI 및 기능 구현.*			 |
| (4) 팀 지도교수 | 이형준 교수님 |
| (5) 과제 분류 | 산학과제 |
| (6) 과제 키워드 | 춤 연습, 안무 시각화, 동작 비교  |
| (7) 과제 내용 요약 | 저희 과제는 K-pop 안무를 혼자 연습하는 사용자의 시간·비용 부담, 학습 효율 및 동기 저하, 재미 부족 문제를 해결하기 위해 기획되었습니다. 실시간으로 사용자의 동작을 분석하기 위해 MediaPipe를 활용하고, 안무가의 실루엣을 시각화하기 위해  SAM2와 OpenCV를 사용합니다. 또한 사용자의 동기부여를 강화를 위해 Unity 기반 가상 아이돌과의 챌린지 모드를 구현하였습니다. 이러한 기술들을 사용하여 사용자와 전문가의 영상 비교, 안무 유사도 평가, 네온 효과를 입힌 안무가 실루엣 제공 등을 통해 더욱 직관적인 학습 환경을 제공하고자 합니다. 따라서 사용자는 장소나 시간 제약 없이 편리하게 반복적인 연습이 가능하며, 지속적인 동기부여와 (피드백을 통한) 실력 향상을 기대할 수 있습니다. 현재까지 MediaPipe 기반 안무 유사도 계산 및 분석, SAM2·OpenCV 기반 안무 실루엣 추출 및 시각화, Unity 기반 아바타의 안무 영상 제작을 완료하였으며, 현재는 백엔드와 프론트엔드 간의 연동 작업을 진행 중입니다. 향후 더욱 정교한 피드백 시스템을 구축할 예정입니다.|

<br>

# Project-Summary
| 항목 | 내용 |
|:---  |---  |
| (1) 문제 정의 |  **Target Customer** <br><li>K-pop 안무를 배우고 싶은 국내외 팬 <br><li> 시간이 부족한 학생 및 직장인<br><li> 오프라인 학원 수강이 어려운 사용자 (경제적 부담 등)<br><li> 혼자 춤을 배우는데 동기부여나 피드백이 부족한 사용자 <br><br>**Pain Points**<br><li>  문제 1: 시간과 비용의 제약<br>댄스 학원에 다니고 싶어도 시간적, 경제적 이유로 부담을 느끼는 사람들이 많습니다. <br><li> 문제 2: 학습 동작 확인의 어려움<br>유튜브로 안무를 학습할 때 거울이 없으면 자신의 동작이 올바른지 한눈에 확인하기 어렵습니다. 또한 안무가의 영상과 자신의 안무를 한번에 확인할 수 없습니다.<br><li>  문제 3: 혼자 연습할 때의 지루함 <br>혼자 춤을 연습하는 경우 반복적인 안무 학습으로 인해 쉽게 지루해질 수 있습니다. 이를 보완하기 위해 가상 아바타와 함께 안무를 수행하는 챌린지 모드를 도입하여 혼자 연습하는 데서 오는 단조로움을 완화할 수 있습니다.  |
| (2) 기존연구와의 비교 | 유사한 서비스로는 K-pop 안무 학습 앱 Stream이 있으며, 저희 서비스와 비교해보았습니다.<br><br><li> **공통점**: 사용자가 안무 가이드를 따라, 혼자서도 안무를 학습할 수 있도록 구성되어 있습니다. <br><br><li> **기존 서비스의 한계**: Stream은 안무가 위에 실루엣이 덧입혀져 있어 세부 동작을 따라하거나, 안무의 정확한 포인트를 파악하는 데 어려움이 있을 수 있습니다. <br><br><li> **우리 서비스의 장점**:<br> 1. 기존 안무의 실루엣 자체를 영상에서 분리해 사용자에게 직접 제공함으로써, 사용자가 정확한 동작 라인을 명확히 인식하고 따라할 수 있도록 설계되었습니다. <br> 2. 기존 안무 실루엣에 네온 효과를 적용해 동작을 강조함으로써, 직관적인 시각적 가이드를 제공합니다. <br> 3. ‘정확도 모드’에서 사용자의 실시간 동작을 분석한 후, 전문가의 안무와 정량적으로 유사도를 비교해 실시간으로 안무 정확도에 대한 점수와 피드백을 제공하는 기능이 있습니다. <br> 4. ‘챌린지 모드’에서는 Unity 기반으로 생성된 가상의 아이돌 아바타와 함께 춤을 즐길 수 있으며, 이는 사용자의 몰입도와 흥미를 유발합니다. <br><br><li> **우리 서비스의 단점**: 한정적으로 제공된 K-pop 안무 영상 기반으로 학습이 이루어지며, Stream 서비스와 달리 사용자가 원하는 영상을 업로드하는 기능은 포함되어 있지 않습니다. <br><br><li> **우리 서비스의 발전 가능성**: 향후 다양한 음악 장르를 지원하기 위해, 사용자가 직접 원하는 영상을 업로드할 수 있는 기능도 고려하고 있습니다. |
| (3) 제안 내용 | 먼저 사용자가 시간과 장소에 구애받지 않고 자유롭게 연습할 수 있도록, 모바일 기반의 안무 연습 서비스를 제공합니다. 또한 사용자가 학습 동작을 확인할 때의 어려움을 해결하기 위해서 MediaPipe 활용하여 사용자의 동작을 실시간으로 분석하고, 안무가의 동작과의 유사도를 수치화하여 피드백을 제공합니다. 추가적으로 안무 실루엣 기능을 SAM2를 사용하여 제공함으로써 사용자가 동작을 더 정확하게 따라할 수 있도록 도와줍니다. 마지막으로 사용자가 혼자 연습할 때 느끼는 지루함을 줄이기 위해, Unity 기반의 가상 아이돌 아바타와 함께하는 챌린지 모드를 도입하였습니다. 이처럼 저희 서비스는 사용자가 언제 어디서든 자유롭게 안무를 연습하고 실시간 피드백을 받으며, 재미있게 꾸준히 안무를 연습할 수 있는 환경을 제공합니다. 이를 통해 사용자는 기존의 한계를 해결하면서도 혼자 꾸준히 실력을 키울 수 있습니다. |
| (4) 기대효과 및 의의 | **1. 편리한 연습 환경**<br><li> 시간과 장소에 구애받지 않고 자유롭게 춤을 연습할 수 있으며, 수강료를 걱정하지 않아도 됩니다. <br><br> **2. 개인 실력 향상** <br><li> 피드백을 통해 사용자의 춤 실력 향상에 도움을 줍니다. <br><br> **3. 지루함 완화** <br><li> 혼자 춤을 출 때 느낄 수 있는 지루함과 단조로움을 가상 아이돌 챌린지를 통해 완화할 수 있습니다. <br><br> **4. 지속적인 동기부여** <br><li> 반복되는 연습 과정에서 오는 단순함을 덜어주고, 사용자가 연습을 꾸준히 이어갈 수 있도록 돕습니다. |
| (5) 주요 기능 리스트 | **1. 관절 인식 및 포즈 추출 기능 (MediaPipe 기반)** <br><li> 사용자의 동작을 정확하게 분석하기 위해, MediaPipe Pose 모델을 활용하여 영상 속 인체의 주요 관절 위치(어깨, 팔꿈치, 손목, 엉덩이, 무릎, 발목 등)를 프레임 단위로 추출합니다.<br><li> 이렇게 추출된 관절 좌표는 정량적인 포즈 데이터로 저장되며, 이후 전문가 안무와의 유사도 비교, 피드백 생성 등에 사용됩니다. <br><li> 모션 캡처 장비 없이도 웹캠이나 스마트폰 카메라만으로 동작 분석이 가능하다는 장점이 있습니다. <br><br>**2. 정확도 모드에서 동작 비교 및 피드백 기능** <br><li> 사용자의 포즈 데이터와 전문가의 포즈 데이터를 비교하여, 각 관절의 위치 또는 관절 각도의 차이를 분석합니다. <br><li> 비교된 결과를 바탕으로 정확도 점수를 계산하고, 그 점수를 기준으로 직관적인 텍스트 피드백을 제공합니다. <br><li> 기본적인 비교는 수학적 계산(예: 유클리드 거리, 관절 각도 차이 등)을 활용하며, 향후 기능으로 GPT 기반 피드백 문장 자동 생성을 고려하고 있습니다. <br><br>**3. 영상 비교 및 시각화 기능 (OpenCV 기반)** <br><li> 분석된 유사도 점수, 피드백 메시지 등을 영상 위에 시각적으로 표시하여, 사용자가 자신의 동작의 문제점을 직관적으로 파악할 수 있도록 돕습니다. <br><li> 필요에 따라 사용자의 오류 구간을 강조하거나, 전문가의 윤곽선만 따서 가이드라인으로 표시하는 등 시각 보조 기능을 포함합니다. <br><br>**4. 안무 실루엣 마스크 생성 기능 (SAM2 + OpenCV 기반)** <br><li> 전문가 영상에서 인물의 윤곽을 자동 추출하기 위해, SAM2(Segment Anything Model v2)를 활용하여 프레임마다 인체 마스크를 생성합니다. <br><li> 이후 OpenCV를 사용해 마스크의 외곽선을 감지하고 시각적으로 강조합니다. <br><li> 또한, 윤곽선에 네온 효과나 그림자 효과를 적용함으로써 동작의 흐름과 범위를 더 명확히 표현하여, 사용자가 거울 없이도 자세를 쉽게 따라할 수 있도록 합니다. <br><br>**5. 가상 아이돌 챌린지 기능 (Unity 기반)**<br><li> 지속적인 학습을 재미있게 이어갈 수 있도록, Unity 기반의 3D 가상 아이돌 캐릭터와 함께 춤을 추는 챌린지 모드를 제공합니다.|

<br>
 
# Project-Design & Implementation
| 항목 | 내용 |
|:---  |---  |
| (1) 요구사항 정의 | |
| (2) 전체 시스템 구성 |  |
| (3) 주요엔진 및 기능 설계 | **1. Client Module (Android App)** <br><li> 역할: 사용자가 앱을 통해 영상 분석 요청을 보내고 결과를 수신함. 앱에서 사용자의 실시간 영상을 보내고 분석 결과를 수신함 <br><li> 기술: Kotlin 기반 안드로이드 앱 <br><li> 기능 상세:<br>실시간 영상 촬영<br>REST API를 통해 EC2 서버로 분석 요청 전송 (예: POST /upload)<br>분석 결과 수신 및 UI 표시<br>- 보안: JWT 또는 OAuth 토큰 기반 인증 <br><br>**2. IntelliJ + JAR Build** <br><li> 역할: 서버 애플리케이션을 개발 및 배포 <br><li> 기술: Java 기반 Spring Boot 애플리케이션을 IntelliJ에서 개발 후 JAR로 빌드 <br><li> 기능 상세: <br>scp 또는 rsync를 이용한 EC2 배포 자동화 (SSH Key 사용) <br>빌드된 JAR을 EC2 내 Docker 환경에 배포 <br><br>**3. Amazon EC2 + Docker 기반** <br>**▷ 3-1. Spring Boot** <br><li> 역할: 클라이언트 요청을 받아 처리하고, 내부 시스템과 연동 <br><li> 기능 상세: <br>REST API 서버 (ex: /upload, /result/{id}) <br>Redis 캐시 사용 (요청 상태 저장 등) <br>Flask, MediaPipe와의 연동 처리 <br>S3 업로드 후 MySQL 로그 기록 <br><br>**▷3-2. Redis** <br><li> 역할: 작업 큐 또는 캐시 역할 <br><li> 기능 상세: <br>요청 ID와 상태 관리 (PENDING, PROCESSING, DONE) <br>실시간 처리 중간 상태 저장 <br><br>**▷ 3-3. Flask** (Python) <br><li> 역할: 영상 분석, 실루엣 추출 로직 실행 <br><li> 기술 스택: Flask + OpenCV + MediaPipe <br><li> 기능 상세: <br>영상 프레임 추출<br>MediaPipe를 이용한 사람 감지 및 주요 관절 좌표 추출<br>추출 결과를 바탕으로 포즈 정확도 평가 지표 계산 (예: 관절 간의 거리, 각도 차이 등) <br>OpenCV 기반 후처리 (binary mask, silhouette)<br>추출된 마스크 영상 생성 및 저장<br><br>**4. Amazon S3**<br><li> 역할: 원본 안무 silhouette 영상 및 서비스 사용자의 개인 영상 저장소<br><li> 기능 상세:<br>분석된 .mp4 silhouette 영상 업로드 <br>사용자의 개인 영상 업로드 <br>업로드 후 해당 경로를 DB 및 클라이언트에 제공<br><br>**5. Meta SAM2**<br><li> 역할: 고정밀 외곽선 마스크를 생성<br><li> 기능 상세:<br>K-pop 안무 영상을 기반으로 silhouette 생성<br>SAM2는 S3를 통해 결과 저장<br><br>**6. Amazon RDS (MySQL)**<br><li> 역할: 분석 로그 및 메타데이터 저장<br><li> DB Connection: Spring Boot가 JPA로 연결<br><br>**■ 전체 프로세스 흐름 요약:**<br>User (App) → 노래 → API 요청 전송<br>Spring Boot → RDS에 저장된 해당 노래의 정보 반환<br>Flask + MediaPipe → 영상 분석 → 사용자의 동작 점수 계산<br>결과 영상 → Amazon S3 업로드<br>로그 → Amazon RDS 기록<br>App → S3 영상 URL로 결과 확인 |
| (4) 주요 기능의 구현 | **1. 동작 유사도 분석 기능 (MediaPipe 기반)** <br><li>사용자가 자신의 안무를 연습할 때, 전문가의 동작과 얼마나 유사한지 스스로 판단하기 어렵다는 문제를 해결하기 위해 MediaPipe의 Pose 모듈을 활용합니다. MediaPipe는 사용자의 영상과 전문가의 영상에서 주요 관절 포인트, 예를 들어 어깨, 팔꿈치, 무릎 등의 관절 포인트들을 프레임 단위로 추출합니다. 이러한 포인트 데이터를 기반으로 Euclidean Distance를 사용하여 동작 유사도를 수치화하고, 사용자에게 실시간 피드백을 제공합니다. 이를 통해 사용자는 별도의 장비나 공간 제약 없이, 정확하고 직관적인 피드백을 통해 안무 실력을 향상시킬 수 있습니다.<br><br>**2. 안무 실루엣 추출 및 시각화 기능 (SAM2 + OpenCV)** <br><li>정확한 동작 파악을 돕기 위해 안무가의 윤곽선을 추출하고, 시각적 가이드를 제공하는 기능을 구현하였습니다. SAM2를 활용해 안무가 영상에서 객체(사람)를 자동으로 인식하고, 전체 프레임에서 해당 객체를 추적하며 세그멘테이션 마스크를 생성합니다. 이후 OpenCV의 findContours와 drawContours 기능을 이용해 윤곽선을 시각화하며, GaussianBlur를 활용해 네온 효과를 적용함으로써 동작 흐름을 더 명확하게 표현합니다. 이를 통해 사용자는 거울 없이도 안무가의 자세를 따라 하기 쉽고, 직관적으로 동작 라인을 인식할 수 있습니다.<br><br>**3. 비교 화면 및 피드백 시각화 기능 (OpenCV 기반)**<br><li>OpenCV를 활용하여 사용자의 실시간 영상을 띄웁니다. 사용자 영상과 cv2.VideoCapture()를 통해 프레임 단위로 읽어온 뒤, cv2.putText()를 사용하여 사용자 영상에 유사도 점수와 텍스트 피드백을 실시간으로 출력합니다. 이를 통해 사용자는 어느 부분이 부족한지 시각적으로 쉽게 확인할 수 있습니다.<br><br>**4. 챌린지 모드 기능 (Unity 기반)** <br><li>반복적인 개인 연습의 지루함을 해결하고자, Unity를 기반으로 한 가상 아이돌 아바타와의 챌린지 모드를 구현하였습니다. 이 기능은 사용자에게 상호작용과 성취감을 제공하며, 몰입도 높은 학습 경험을 유도합니다.*|
| (5) 기타 |더 효과적인 피드백을 짧은 구간(약 5초)마다 동작을 분석하여 오차가 큰 시점의 관절 좌표를 기반으로 간단한 텍스트 피드백 제공 예정입니다. (예: “팔을 더 안으로 굽히세요”, “손목을 내리세요” 등)|

<br>
